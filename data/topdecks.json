---
---
[
  {% capture currentYear %}{{ 'now' | date: "%Y" }}{% endcapture %}
  {% capture currentMonth %}{{ 'now' | date: "%m" }}{% endcapture %}

  {% assign decks = site.data.top-decks[currentYear][currentMonth] %}

  {% for decktype in decks %}
      {% for tier in site.data.tierlist %}
        {% for type in tier.types %}
          {% if type.id == decktype[0] %}
            {% assign tiertype = type %}
          {% endif %}
        {% endfor %}
      {% endfor %}
      {
        "id": "{{decktype[0]}}",
        "display": "{{tiertype.display}}",
        "card": "{{tiertype.card}}",
        "count": "{{decktype[1].size}}",
        "decks":
        [
          {% for deck in decktype[1] %}
            {% assign start = deck[1].name | slice: 0, 2 %}
            {% if start != '##'  %}
              {% assign deckName = deck[1].name %}
            {% else %}
              {% assign deckName = deck[1].author | append: "'s " | append: tiertype.display | remove: " Decks" | append: " Deck" %}
            {% endif %}
            {
              "author": "{{deck[1].author | escape_backslashes }}",
              "name": "{{deckName | escape_backslashes }}",
              "url": "{{deck[1].url}}",
              "created": "{{deck[1].created}}",
              "front": "{{tiertype.card}}",
              "skill": "{{deck[1].skill}}"
            }{% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
      }
      {% unless forloop.last %},{% endunless %}
  {% endfor %}
]